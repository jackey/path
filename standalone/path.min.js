!function(a){"use strict";function o(){return this.init(),this}function p(){var c,d,a=Array.prototype.slice.call(arguments,0),b=a.shift();if("object"==typeof b)for(c in b)void 0!==b[c]&&l.define(c,b[c]);else for("function"==typeof b&&(a.unshift(b),b="*"),c=0,d=a.length,c;d>c;c+=1)l.define(b,a[c]);return p}var l,b=a,c=b.document,d=b.location,e=b.addEventListener?"addEventListener":"attachEvent",f="attachEvent"===e?"onload":"load",g="attachEvent"===e?"onclick":"click",h="attachEvent"===e?"onhashchange":"hashchange",i=void 0!==b.onpopstate,j="popstate",k=!0,m=function(a){return a.pathname},n=function(a,d,e){b.history.pushState(e,d,a),c.title=d};i||(m=function(a){return a.hash.split("#!")[1]||"/"},n=function(a,b){var g,f=d.hash.match(/\#!?\/?(.[^\?|\&|\s]+)/);f=f?f[1]:"/",g=new RegExp(f),d.hash.replace(g,a),c.title=b}),o.prototype.init=function(){var a=this;return this._collection={},b[e](f,function(){a.currentState=m(d),a.match(a.currentState)},!1),b[e](j,function(){a.currentState=m(d),a.match(a.currentState)},!1),c[e](g,function(c){c=c||b.event;var e=c.target||c.srcElement;if("A"===e.nodeName&&null!==e.getAttribute("data-path")){if(c.which>1||c.metaKey||c.ctrlKey||c.shiftKey||c.altKey)return;if(d.protocol!==e.protocol||d.hostname!==e.hostname)return;a.load(m(e),e.title,{}),i?c.preventDefault():k=!1}}),i||b[e](h,function(){if(k){var b=d.hash.match(/\#!?(.[^\?|\&|\s]+)/);b=b?b[1]:"/",a.currentPath=b,a.match(a.currentPath)}k=!0}),this},o.prototype.match=function(a){var c,d,f,g,h,b=this._collection,e=0;for(d in b)if(void 0!==b[d]&&"*"!==d&&(f=b[d],g=a.match(f.regexp)))for(g.splice(0,1),c=b[d].listeners,h=c.length,e;h>e;e+=1)c[e].apply(void 0,g);if(void 0!==b["*"])for(e=0,c=b["*"].listeners,h=c.length,e;h>e;e+=1)c[e]();return this},o.prototype.define=function(a,b){return void 0===this._collection[a]&&(this._collection[a]={listeners:[]},"*"!==a&&(this._collection[a].regexp=new RegExp("^"+a.replace(/:\w+/g,"([^\\/]+)").replace(/\//g,"\\/")+"$"))),this._collection[a].listeners.push(b),this},o.prototype.remove=function(a,b){var c=this._collection[a].listeners,d=0,e=c.length;if(void 0!==e)for(d;e>d;d+=1)if(c[d]===b){c.splice(d,1);break}return(0===c.length||void 0===b)&&delete this._collection[a],this},o.prototype.getListeners=function(a){return void 0!==a?this._collection[a]:this._collection},o.prototype.load=function(a,b,c){return this.currentState=a,n(a,b,c),this.match(a),this},l=new o,p.load=function(a,b,c){return l.load(a,b,c),p},p.remove=function(a,b){return l.remove(a,b),p},p.getListeners=function(a){return l.getListeners(a)},"function"==typeof a.define&&void 0!==a.define.amd?a.define("path",[],function(){return p}):"undefined"!=typeof module&&void 0!==module.exports?module.exports=p:a.path=p}(this);